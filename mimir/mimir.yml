# Grafana Mimir Configuration
# Horizontally scalable, highly available, multi-tenant TSDB for Prometheus
#
# Benefits:
# - Long-term storage for Prometheus metrics
# - Horizontal scaling for high availability
# - Query federation across multiple Prometheus instances
# - Reduces metric staleness issues on page refresh

# Common settings
target: all

# Multi-tenancy (disabled for single-tenant mode)
multitenancy_enabled: false

# Server configuration
server:
  http_listen_port: 9009
  grpc_listen_port: 9095
  log_level: info

# Distributor configuration (receives writes from Prometheus)
distributor:
  ring:
    kvstore:
      store: memberlist

# Ingester configuration (stores time series in memory)
ingester:
  ring:
    kvstore:
      store: memberlist
    replication_factor: 1

# Querier configuration (handles queries)
# Note: query_frontend_address is not needed in single-process mode
querier:
  max_concurrent: 20

# Storage configuration (local filesystem for development, use S3/GCS for production)
blocks_storage:
  backend: filesystem
  filesystem:
    dir: /data/mimir/blocks
  tsdb:
    dir: /data/mimir/tsdb
  bucket_store:
    sync_dir: /data/mimir/bucket-sync

# Compactor configuration (compacts blocks for efficient storage)
compactor:
  data_dir: /data/mimir/compactor
  sharding_ring:
    kvstore:
      store: memberlist

# Store gateway configuration
store_gateway:
  sharding_ring:
    replication_factor: 1

# Limits configuration
limits:
  # Maximum number of series per user
  max_global_series_per_user: 500000
  # Maximum number of series per metric
  max_global_series_per_metric: 50000
  # Ingestion rate limit
  ingestion_rate: 50000
  ingestion_burst_size: 100000
  # Query limits
  max_query_lookback: 30d
  max_query_parallelism: 32
  # Retention
  compactor_blocks_retention_period: 30d

# Memberlist configuration (for service discovery)
memberlist:
  join_members:
    - mimir:7946

# Ruler configuration (for recording rules and alerts)
ruler:
  enable_api: true
  alertmanager_url: http://alertmanager:9093

# Activity tracker (helps with debugging stale metrics)
activity_tracker:
  filepath: /data/mimir/activity.log

# Frontend configuration (disabled for single-process mode)
# frontend:
#   results_cache:
#     backend: ""
