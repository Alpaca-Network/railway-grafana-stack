apiVersion: 1

datasources:
  # Self-hosted Pyroscope — continuous profiling for gatewayz-backend.
  #
  # ARCHITECTURE (two separate Railway projects):
  #
  #   gatewayz-backend project          railway-grafana-stack project
  #   ─────────────────────             ──────────────────────────────
  #   gatewayz-backend  ──PUSH──►  pyroscope (public domain)
  #                                      │
  #                                   Grafana ◄──READ── pyroscope.railway.internal:4040
  #
  # The Pyroscope service lives in THIS (grafana-stack) project, so Grafana
  # reaches it via Railway's internal DNS — zero egress cost, zero latency.
  #
  # The gatewayz-backend is in a DIFFERENT project and cannot use .railway.internal.
  # It pushes to Pyroscope's PUBLIC Railway domain (generate one in the Railway
  # dashboard: Pyroscope service → Settings → Generate Domain).
  #
  # Required Railway env vars on THIS (Grafana) service:
  #   PYROSCOPE_INTERNAL_URL  — internal URL for Grafana to read profiles
  #                             Railway: http://pyroscope.railway.internal:4040
  #                             Local docker-compose: http://pyroscope:4040 (default)
  #
  # Required Railway env vars on the BACKEND service:
  #   PYROSCOPE_ENABLED=true
  #   PYROSCOPE_SERVER_ADDRESS — Pyroscope's PUBLIC Railway domain
  #                              e.g. https://pyroscope-production-xxxx.up.railway.app
  #   (No auth vars needed — self-hosted Pyroscope has no auth by default)
  - name: Pyroscope
    uid: grafana_pyroscope
    type: grafana-pyroscope-datasource   # built-in in Grafana 10+, no plugin needed
    access: proxy
    url: ${PYROSCOPE_INTERNAL_URL:-http://pyroscope:4040}
    basicAuth: false
    isDefault: false
    editable: true
    jsonData:
      httpMethod: GET
