apiVersion: 1

datasources:
  # Grafana Cloud hosted Pyroscope — continuous profiling for gatewayz-backend.
  #
  # WHY GRAFANA CLOUD (not self-hosted on Railway):
  #   The gatewayz-backend and the railway-grafana-stack are in TWO SEPARATE
  #   Railway projects. Railway's internal DNS (*.railway.internal) only works
  #   within the same project. A self-hosted Pyroscope container inside the
  #   grafana-stack project would be unreachable from the backend's push calls.
  #
  #   Grafana Cloud acts as a neutral external collector that both projects can
  #   reach independently:
  #     • gatewayz-backend  → PUSH → https://profiles-prod-xxx.grafana.net
  #     • railway-grafana-stack → READ → https://profiles-prod-xxx.grafana.net
  #
  # Required Railway env vars on THIS (Grafana) service:
  #   PYROSCOPE_SERVER_ADDRESS  — Grafana Cloud Pyroscope URL
  #                               e.g. https://profiles-prod-006.grafana.net
  #   PYROSCOPE_AUTH_USER       — Grafana Cloud numeric instance ID
  #   PYROSCOPE_AUTH_PASSWORD   — Grafana Cloud API token (profiles:read scope)
  #
  # The same vars go on the backend service (with profiles:write scope on the token).
  - name: Pyroscope
    uid: grafana_pyroscope
    type: grafana-pyroscope-datasource   # built-in in Grafana 10+, no plugin needed
    access: proxy
    url: ${PYROSCOPE_SERVER_ADDRESS}
    isDefault: false
    editable: true
    jsonData:
      httpMethod: GET
    secureJsonData:
      basicAuthUser: ${PYROSCOPE_AUTH_USER}
      basicAuthPassword: ${PYROSCOPE_AUTH_PASSWORD}
