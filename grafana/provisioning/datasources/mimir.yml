apiVersion: 1

datasources:
  # Mimir - Long-term metrics storage
  # Use this datasource for:
  # - Historical queries (longer than Prometheus retention)
  # - Consistent query results across page refreshes
  # - Aggregated metrics from multiple Prometheus instances
  # NOTE: MIMIR_INTERNAL_URL is set in Dockerfile to http://mimir.railway.internal:9009
  - name: Mimir
    uid: grafana_mimir
    type: prometheus
    access: proxy
    url: ${MIMIR_INTERNAL_URL}/prometheus
    isDefault: false
    editable: true
    jsonData:
      httpMethod: POST
      manageAlerts: false
      prometheusType: Mimir
      prometheusVersion: 2.11.0
      # Query timeout
      timeout: 60
      # REQUIRED: X-Scope-OrgID header for Mimir tenant identification
      # Even with multitenancy_enabled: false, Mimir requires this header
      # "anonymous" is the default tenant used when multi-tenancy is disabled
      httpHeaderName1: X-Scope-OrgID
      # Enable exemplars for trace correlation.
      # Field name MUST match what the backend emits â€” use trace_id (underscore)
      # to stay consistent with Prometheus datasource and OpenTelemetry convention.
      exemplarTraceIdDestinations:
        - name: trace_id
          datasourceUid: grafana_tempo
    secureJsonData:
      httpHeaderValue1: anonymous
    version: 1
